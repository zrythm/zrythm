{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "schema:project",
  "title": "Zrythm Project File",
  "description": "Schema for Zrythm project files (UNSTABLE - v2.alpha under active development)",
  "type": "object",
  "required": [
    "documentType",
    "formatMajor",
    "formatMinor",
    "appVersion",
    "datetime",
    "title",
    "projectData"
  ],
  "properties": {
    "documentType": {
      "type": "string",
      "const": "ZrythmProject",
      "description": "Document type identifier"
    },
    "formatMajor": {
      "type": "integer",
      "description": "Major format version (breaking changes)",
      "minimum": 0
    },
    "formatMinor": {
      "type": "integer",
      "description": "Minor format version (backward-compatible additions)",
      "minimum": 0
    },
    "appVersion": {
      "type": "string",
      "description": "Zrythm version that created this file"
    },
    "datetime": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 datetime when project was saved"
    },
    "title": {
      "type": "string",
      "description": "Project title"
    },
    "projectData": {
      "type": "object",
      "description": "Project data",
      "required": [
        "tempoMap",
        "transport",
        "tracklist",
        "registries"
      ],
      "properties": {
        "tempoMap": {
          "type": "object",
          "description": "Tempo and time signature map",
          "properties": {
            "timeSignatures": {
              "type": "array",
              "description": "Time signature events",
              "items": {
                "type": "object",
                "properties": {
                  "position": {
                    "type": "number",
                    "description": "Position in ticks"
                  },
                  "numerator": {
                    "type": "integer",
                    "minimum": 1
                  },
                  "denominator": {
                    "type": "integer",
                    "minimum": 1,
                    "enum": [
                      1,
                      2,
                      4,
                      8,
                      16,
                      32,
                      64,
                      128
                    ]
                  }
                }
              }
            },
            "tempoChanges": {
              "type": "array",
              "description": "Tempo change events",
              "items": {
                "type": "object",
                "properties": {
                  "position": {
                    "type": "number",
                    "description": "Position in ticks"
                  },
                  "bpm": {
                    "type": "number",
                    "minimum": 1,
                    "maximum": 1000
                  }
                }
              }
            }
          }
        },
        "transport": {
          "type": "object",
          "description": "Transport state (playhead, loop, etc.)",
          "properties": {
            "playheadPosition": {
              "$ref": "#/definitions/position"
            },
            "cuePosition": {
              "$ref": "#/definitions/position"
            },
            "loopRange": {
              "$ref": "#/definitions/positionRange"
            },
            "punchRange": {
              "$ref": "#/definitions/positionRange"
            }
          }
        },
        "snapGridTimeline": {
          "$ref": "#/definitions/snapGrid",
          "description": "Timeline snap/grid settings"
        },
        "snapGridEditor": {
          "$ref": "#/definitions/snapGrid",
          "description": "Editor (piano roll, chord editor, etc.) snap/grid settings"
        },
        "tracklist": {
          "type": "object",
          "description": "Track list and track data",
          "required": [
            "tracks",
            "pinnedTracksCutoff",
            "trackRoutes"
          ],
          "properties": {
            "tracks": {
              "type": "array",
              "description": "UUID references to tracks in trackRegistry (ordered)",
              "items": {
                "$ref": "#/definitions/uuid"
              }
            },
            "pinnedTracksCutoff": {
              "type": "integer",
              "description": "Index separating pinned tracks from normal tracks"
            },
            "trackRoutes": {
              "type": "array",
              "description": "Routes between tracks (source-destination mappings)",
              "items": {
                "type": "array",
                "items": [
                  {
                    "$ref": "#/definitions/uuid",
                    "description": "Source track UUID"
                  },
                  {
                    "$ref": "#/definitions/uuid",
                    "description": "Destination track UUID"
                  }
                ],
                "additionalItems": false
              }
            }
          }
        },
        "audioPool": {
          "type": "object",
          "description": "References to audio files used in the project",
          "properties": {
            "audioFiles": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "id": {
                    "type": "string",
                    "description": "UUID reference to file in fileAudioSourceRegistry"
                  },
                  "filename": {
                    "type": "string"
                  },
                  "sampleRate": {
                    "type": "integer"
                  },
                  "channels": {
                    "type": "integer",
                    "enum": [
                      1,
                      2
                    ]
                  },
                  "frames": {
                    "type": "integer",
                    "minimum": 0
                  },
                  "filePath": {
                    "type": "string",
                    "description": "Relative path to audio file in pool"
                  }
                }
              }
            }
          }
        },
        "portConnectionsManager": {
          "type": "object",
          "description": "Manual port connections (user routing)",
          "properties": {
            "connections": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "sourcePortId": {
                    "type": "string",
                    "description": "UUID of source port"
                  },
                  "destPortId": {
                    "type": "string",
                    "description": "UUID of destination port"
                  },
                  "multiplier": {
                    "type": "number",
                    "description": "Connection strength/gain multiplier"
                  },
                  "enabled": {
                    "type": "boolean"
                  }
                }
              }
            }
          }
        },
        "tempoObjectManager": {
          "type": "object",
          "description": "Tempo and time signature objects in arranger",
          "properties": {
            "tempoObjects": {
              "$ref": "#/definitions/uuidArray",
              "description": "UUID references to tempoObject objects in arrangerObjectRegistry"
            },
            "timeSignatureObjects": {
              "$ref": "#/definitions/uuidArray",
              "description": "UUID references to timeSignatureObject objects in arrangerObjectRegistry"
            }
          }
        },
        "registries": {
          "type": "object",
          "description": "All UUID-indexed objects (deserialized first, then referenced)",
          "required": [
            "portRegistry",
            "paramRegistry",
            "pluginRegistry",
            "trackRegistry",
            "arrangerObjectRegistry",
            "fileAudioSourceRegistry"
          ],
          "properties": {
            "portRegistry": {
              "type": "array",
              "description": "All audio/MIDI ports",
              "items": {
                "$ref": "#/definitions/knownPort"
              }
            },
            "paramRegistry": {
              "type": "array",
              "description": "All processor parameters",
              "items": {
                "$ref": "#/definitions/parameter"
              }
            },
            "pluginRegistry": {
              "type": "array",
              "description": "All plugin instances",
              "items": {
                "$ref": "#/definitions/plugin"
              }
            },
            "trackRegistry": {
              "type": "array",
              "description": "All tracks with full data",
              "items": {
                "$ref": "#/definitions/knownTracks"
              }
            },
            "arrangerObjectRegistry": {
              "type": "array",
              "description": "All arranger objects (regions, notes, automation, markers, etc.)",
              "items": {
                "$ref": "#/definitions/knownArrangerObjects"
              }
            },
            "fileAudioSourceRegistry": {
              "type": "array",
              "description": "All audio file references",
              "items": {
                "type": "object",
                "required": [
                  "id",
                  "filename",
                  "filePath"
                ],
                "properties": {
                  "id": {
                    "$ref": "#/definitions/uuid"
                  },
                  "filename": {
                    "type": "string"
                  },
                  "filePath": {
                    "type": "string",
                    "description": "Relative path in the project audio pool"
                  },
                  "sampleRate": {
                    "type": "integer"
                  },
                  "channels": {
                    "type": "integer",
                    "enum": [
                      1,
                      2
                    ]
                  },
                  "frames": {
                    "type": "integer",
                    "minimum": 0
                  },
                  "bitsPerSample": {
                    "type": "integer",
                    "minimum": 8,
                    "maximum": 32,
                    "description": "Bit depth (8, 16, 24, or 32)"
                  },
                  "format": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 4,
                    "description": "Audio format: 1=mp3, 2=flac, 3=ogg, 4=wav"
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "definitions": {
    "uuid": {
      "type": "string",
      "format": "uuid",
      "pattern": "^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",
      "description": "UUID string format"
    },
    "uuidArray": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/uuid"
      },
      "description": "Array of UUID strings"
    },
    "position": {
      "type": "object",
      "description": "Position in time (ticks or seconds)",
      "properties": {
        "mode": {
          "type": "integer",
          "minimum": 0,
          "maximum": 1,
          "description": "0=musical, 1=absolute"
        },
        "value": {
          "type": "number",
          "description": "Ticks or seconds"
        }
      }
    },
    "positionRange": {
      "type": "object",
      "description": "Position range",
      "properties": {
        "start": {
          "$ref": "#/definitions/position"
        },
        "end": {
          "$ref": "#/definitions/position"
        }
      }
    },
    "noteLength": {
      "type": "integer",
      "minimum": 0,
      "maximum": 10,
      "description": "Bar=0, Beat=1, 2/1=2, 1/1=3, 1/2=4, 1/4=5, 1/8=6, 1/16=7, 1/32=8, 1/64=9, 1/128=10"
    },
    "noteType": {
      "type": "integer",
      "minimum": 0,
      "maximum": 2,
      "description": "0=normal, 1=dotted, 2=triplet"
    },
    "snapGrid": {
      "type": "object",
      "properties": {
        "snapEnabled": {
          "type": "boolean"
        },
        "snapNoteLength": {
          "$ref": "#/definitions/noteLength"
        },
        "snapNoteType": {
          "$ref": "#/definitions/noteType"
        },
        "adaptive": {
          "type": "boolean"
        },
        "lengthType": {
          "type": "integer",
          "minimum": 0,
          "maximum": 2,
          "description": "0=link, 1=lastObject, 2=custom"
        },
        "keepOffset": {
          "type": "boolean"
        },
        "snapToEvents": {
          "type": "boolean"
        }
      }
    },
    "registryObjectBase": {
      "$comment": "Base class for all objects in registries",
      "type": "object",
      "required": [
        "id"
      ],
      "properties": {
        "id": {
          "$ref": "#/definitions/uuid"
        }
      }
    },
    "portBase": {
      "$comment": "Base class for all port types",
      "allOf": [
        {
          "$ref": "#/definitions/registryObjectBase"
        },
        {
          "properties": {
            "type": {
              "type": "integer",
              "minimum": 0,
              "maximum": 2,
              "description": "0=audio, 1=midi, 2=cv"
            },
            "flow": {
              "type": "integer",
              "minimum": 0,
              "maximum": 1,
              "description": "0=input, 1=output"
            },
            "label": {
              "type": "string"
            },
            "symbol": {
              "type": "string"
            },
            "portGroup": {
              "type": "string"
            }
          },
          "required": [
            "type",
            "flow"
          ]
        }
      ]
    },
    "audioPort": {
      "$comment": "Audio port (derives from portBase)",
      "allOf": [
        {
          "$ref": "#/definitions/portBase"
        },
        {
          "properties": {
            "type": {
              "const": 0
            },
            "busLayout": {
              "type": "integer",
              "minimum": 0,
              "maximum": 1,
              "description": "0=mono, 1=stereo"
            },
            "purpose": {
              "type": "integer",
              "minimum": 0,
              "maximum": 1,
              "description": "0=main, 1=sidechain"
            },
            "requiresLimiting": {
              "type": "boolean"
            }
          }
        }
      ]
    },
    "midiPort": {
      "$comment": "MIDI port (derives from portBase)",
      "allOf": [
        {
          "$ref": "#/definitions/portBase"
        },
        {
          "properties": {
            "type": {
              "const": 1
            }
          }
        }
      ]
    },
    "cvPort": {
      "$comment": "CV port (derives from portBase)",
      "allOf": [
        {
          "$ref": "#/definitions/portBase"
        },
        {
          "properties": {
            "type": {
              "const": 2
            }
          }
        }
      ]
    },
    "knownPort": {
      "$comment": "Polymorphic reference for any known port type",
      "oneOf": [
        {
          "$ref": "#/definitions/audioPort"
        },
        {
          "$ref": "#/definitions/midiPort"
        },
        {
          "$ref": "#/definitions/cvPort"
        }
      ]
    },
    "parameter": {
      "$comment": "Processor parameter",
      "allOf": [
        {
          "$ref": "#/definitions/registryObjectBase"
        },
        {
          "properties": {
            "uniqueId": {
              "type": "string"
            },
            "baseValue": {
              "type": "number",
              "description": "Normalized parameter value set by the user in the UI (0.0-1.0)"
            },
            "modulationSource": {
              "$ref": "#/definitions/uuid",
              "description": "Input CV port ID for modulation, if parameter is modulatable"
            }
          },
          "required": [
            "uniqueId",
            "baseValue"
          ]
        }
      ]
    },
    "processorBase": {
      "$comment": "Base class for all processor types",
      "required": [
        "name",
        "inputPorts",
        "outputPorts",
        "parameters"
      ],
      "properties": {
        "name": {
          "type": "string"
        },
        "inputPorts": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/uuid"
          }
        },
        "outputPorts": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/uuid"
          }
        },
        "parameters": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/uuid"
          }
        }
      }
    },
    "pluginConfiguration": {
      "$comment": "Plugin configuration",
      "type": "object",
      "properties": {
        "forceGenericUi": {
          "type": "boolean"
        }
      },
      "unevaluatedProperties": false
    },
    "plugin": {
      "allOf": [
        {
          "$ref": "#/definitions/processorBase"
        },
        {
          "properties": {
            "id": {
              "$ref": "#/definitions/uuid"
            },
            "protocol": {
              "type": "integer",
              "minimum": 0,
              "maximum": 10,
              "description": "Plugin protocol: 0=internal, 1=lv2, 2=dssi, 3=ladspa, 4=vst, 5=vst3, 6=au, 7=sfz, 8=sf2, 9=clap, 10=jsfx"
            },
            "setting": {
              "$ref": "#/definitions/pluginConfiguration"
            },
            "programIndex": {
              "type": "integer"
            },
            "inlineState": {
              "$comment": "JUCE-compatible inline plugin state as a base64-encoded string",
              "type": "string"
            },
            "statePath": {
              "$comment": "Path to the plugin state, if not using inline state",
              "type": "string"
            },
            "statePathIsDirectory": {
              "$comment": "Whether the statePath is a directory (assumed to be a file if false)",
              "type": "boolean"
            },
            "visible": {
              "$comment": "Whether the plugin UI is currently opened",
              "type": "boolean"
            }
          },
          "required": [
            "id",
            "protocol",
            "setting"
          ]
        }
      ]
    },
    "trackBase": {
      "$comment": "Base class for all track types",
      "allOf": [
        {
          "$ref": "#/definitions/registryObjectBase"
        },
        {
          "properties": {
            "type": {
              "description": "Track type discriminator (must be overridden in derived schemas)",
              "type": "integer",
              "minimum": 0,
              "maximum": 11
            },
            "name": {
              "type": "string"
            },
            "iconName": {
              "type": "string"
            },
            "visible": {
              "type": "boolean"
            },
            "mainHeight": {
              "type": "number"
            },
            "enabled": {
              "type": "boolean"
            },
            "color": {
              "type": "string",
              "pattern": "^#[0-9A-Fa-f]{6}$"
            },
            "inSignalType": {
              "type": "integer",
              "minimum": 0,
              "maximum": 3,
              "description": "0=Audio, 1=MIDI, 2=CV, 3=None"
            },
            "outSignalType": {
              "type": "integer",
              "minimum": 0,
              "maximum": 3,
              "description": "0=Audio, 1=MIDI, 2=CV, 3=None"
            },
            "comment": {
              "type": "string"
            },
            "frozenClipId": {
              "$ref": "#/definitions/uuid"
            },
            "processor": {
              "type": "object",
              "description": "Track processor (for instrument/audio tracks)",
              "properties": {
                "id": {
                  "$ref": "#/definitions/uuid"
                },
                "stereoInPortId": {
                  "$ref": "#/definitions/uuid"
                },
                "stereoOutPortId": {
                  "$ref": "#/definitions/uuid"
                },
                "midiInPortId": {
                  "$ref": "#/definitions/uuid"
                },
                "midiOutPortId": {
                  "$ref": "#/definitions/uuid"
                },
                "pluginIds": {
                  "type": "array",
                  "description": "Plugins in the processing chain",
                  "items": {
                    "$ref": "#/definitions/uuid"
                  }
                }
              }
            },
            "automationTracklist": {
              "type": "object",
              "description": "Automation tracks for this track",
              "properties": {
                "automationTracks": {
                  "type": "array",
                  "items": {
                    "$ref": "#/definitions/uuid"
                  }
                }
              }
            },
            "channel": {
              "type": "object",
              "description": "Track channel (fader, sends, etc.)",
              "properties": {
                "id": {
                  "$ref": "#/definitions/uuid"
                },
                "faderId": {
                  "$ref": "#/definitions/uuid",
                  "description": "UUID of fader processor"
                },
                "stereoInPortId": {
                  "$ref": "#/definitions/uuid",
                  "description": "UUID of stereo input port"
                },
                "stereoOutPortId": {
                  "$ref": "#/definitions/uuid",
                  "description": "UUID of stereo output port"
                },
                "midiInPortId": {
                  "$ref": "#/definitions/uuid"
                },
                "midiOutPortIds": {
                  "type": "array",
                  "items": {
                    "$ref": "#/definitions/uuid"
                  }
                },
                "sends": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "id": {
                        "$ref": "#/definitions/uuid"
                      },
                      "destTrackId": {
                        "type": "string"
                      },
                      "portId": {
                        "$ref": "#/definitions/uuid"
                      },
                      "amount": {
                        "type": "number"
                      },
                      "enabled": {
                        "type": "boolean"
                      }
                    }
                  }
                }
              }
            },
            "modulators": {
              "type": "object",
              "description": "Plugin group for modulators",
              "properties": {
                "pluginIds": {
                  "type": "array",
                  "items": {
                    "$ref": "#/definitions/uuid"
                  }
                }
              }
            },
            "modulatorMacros": {
              "type": "array",
              "description": "Modulator macro processors",
              "items": {
                "$ref": "#/definitions/uuid"
              }
            },
            "lanes": {
              "type": "object",
              "description": "Track lanes (for MIDI/instrument tracks)",
              "properties": {
                "trackLanes": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "id": {
                        "$ref": "#/definitions/uuid"
                      },
                      "index": {
                        "type": "integer"
                      },
                      "height": {
                        "type": "number"
                      },
                      "objects": {
                        "$ref": "#/definitions/uuidArray",
                        "description": "UUID references to arranger objects in this lane"
                      }
                    }
                  }
                }
              }
            },
            "recordableTrackMixin": {
              "type": "object",
              "description": "Recordable track functionality",
              "properties": {
                "recordingMode": {
                  "type": "integer",
                  "minimum": 0,
                  "maximum": 3,
                  "description": "0=overwrite_events, 1=merge_events, 2=takes, 3=takes_muted"
                }
              }
            },
            "pianoRollTrackMixin": {
              "type": "object",
              "description": "Piano roll track functionality",
              "properties": {
                "lastClearedObjectHeight": {
                  "type": "number"
                },
                "lastClearedObjectPosX": {
                  "type": "number"
                }
              }
            }
          },
          "required": [
            "type",
            "name"
          ]
        }
      ]
    },
    "audioTrack": {
      "$comment": "Audio track (derives from trackBase)",
      "allOf": [
        {
          "$ref": "#/definitions/trackBase"
        },
        {
          "properties": {
            "type": {
              "const": 9
            }
          }
        }
      ]
    },
    "instrumentTrack": {
      "$comment": "Instrument track (derives from trackBase)",
      "allOf": [
        {
          "$ref": "#/definitions/trackBase"
        },
        {
          "properties": {
            "type": {
              "const": 1
            }
          }
        }
      ]
    },
    "midiTrack": {
      "$comment": "MIDI track (derives from trackBase)",
      "allOf": [
        {
          "$ref": "#/definitions/trackBase"
        },
        {
          "properties": {
            "type": {
              "const": 2
            }
          }
        }
      ]
    },
    "masterTrack": {
      "$comment": "Master track (derives from trackBase)",
      "allOf": [
        {
          "$ref": "#/definitions/trackBase"
        },
        {
          "properties": {
            "type": {
              "const": 3
            }
          }
        }
      ]
    },
    "chordTrack": {
      "$comment": "Chord track (derives from trackBase)",
      "allOf": [
        {
          "$ref": "#/definitions/trackBase"
        },
        {
          "properties": {
            "type": {
              "const": 10
            }
          }
        }
      ]
    },
    "markerTrack": {
      "$comment": "Marker track (derives from trackBase)",
      "allOf": [
        {
          "$ref": "#/definitions/trackBase"
        },
        {
          "properties": {
            "type": {
              "const": 0
            }
          }
        }
      ]
    },
    "modulatorTrack": {
      "$comment": "Modulator track (derives from trackBase)",
      "allOf": [
        {
          "$ref": "#/definitions/trackBase"
        },
        {
          "properties": {
            "type": {
              "const": 11
            }
          }
        }
      ]
    },
    "audioBusTrack": {
      "$comment": "Audio bus track (derives from trackBase)",
      "allOf": [
        {
          "$ref": "#/definitions/trackBase"
        },
        {
          "properties": {
            "type": {
              "const": 8
            }
          }
        }
      ]
    },
    "audioGroupTrack": {
      "$comment": "Audio group track (derives from trackBase)",
      "allOf": [
        {
          "$ref": "#/definitions/trackBase"
        },
        {
          "properties": {
            "type": {
              "const": 5
            }
          }
        }
      ]
    },
    "midiBusTrack": {
      "$comment": "MIDI bus track (derives from trackBase)",
      "allOf": [
        {
          "$ref": "#/definitions/trackBase"
        },
        {
          "properties": {
            "type": {
              "const": 7
            }
          }
        }
      ]
    },
    "midiGroupTrack": {
      "$comment": "MIDI group track (derives from trackBase)",
      "allOf": [
        {
          "$ref": "#/definitions/trackBase"
        },
        {
          "properties": {
            "type": {
              "const": 4
            }
          }
        }
      ]
    },
    "arrangerObjectBase": {
      "$comment": "Base class for all arranger objects",
      "allOf": [
        {
          "$ref": "#/definitions/registryObjectBase"
        },
        {
          "properties": {
            "type": {
              "description": "Arranger object type discriminator (must be overridden in derived schemas)",
              "type": "integer",
              "minimum": 0,
              "maximum": 11
            },
            "position": {
              "$ref": "#/definitions/position"
            },
            "name": {
              "type": "string"
            },
            "color": {
              "type": "string",
              "pattern": "^#[0-9A-Fa-f]{6}$"
            },
            "muted": {
              "type": "boolean"
            }
          },
          "required": [
            "type",
            "position"
          ]
        }
      ]
    },
    "regionBase": {
      "$comment": "Base class for regions (derives from arrangerObjectBase)",
      "allOf": [
        {
          "$ref": "#/definitions/arrangerObjectBase"
        },
        {
          "properties": {
            "endPosition": {
              "$ref": "#/definitions/position"
            },
            "clipStartPosition": {
              "$ref": "#/definitions/position"
            },
            "loopStartPosition": {
              "$ref": "#/definitions/position"
            },
            "loopEndPosition": {
              "$ref": "#/definitions/position"
            }
          },
          "required": [
            "endPosition",
            "clipStartPosition",
            "loopStartPosition",
            "loopEndPosition"
          ]
        }
      ]
    },
    "midiNote": {
      "$comment": "MIDI note (derives from arrangerObjectBase)",
      "allOf": [
        {
          "$ref": "#/definitions/arrangerObjectBase"
        },
        {
          "properties": {
            "type": {
              "const": 0
            },
            "pitch": {
              "type": "integer",
              "minimum": 0,
              "maximum": 127,
              "description": "MIDI note pitch (0-127)"
            },
            "velocity": {
              "type": "integer",
              "minimum": 0,
              "maximum": 127,
              "description": "MIDI note velocity (0-127)"
            }
          },
          "required": [
            "pitch",
            "velocity"
          ]
        }
      ]
    },
    "midiRegion": {
      "$comment": "MIDI region (derives from regionBase)",
      "allOf": [
        {
          "$ref": "#/definitions/regionBase"
        },
        {
          "properties": {
            "type": {
              "const": 3
            },
            "midiNotes": {
              "$ref": "#/definitions/uuidArray",
              "description": "UUID references to midiNote objects in arrangerObjectRegistry"
            }
          }
        }
      ]
    },
    "audioRegion": {
      "$comment": "Audio region (derives from regionBase)",
      "allOf": [
        {
          "$ref": "#/definitions/regionBase"
        },
        {
          "properties": {
            "type": {
              "const": 4
            },
            "audioSources": {
              "$ref": "#/definitions/uuidArray",
              "description": "UUID references to audioSourceObject objects in arrangerObjectRegistry"
            }
          }
        }
      ]
    },
    "audioSourceObject": {
      "$comment": "Audio source object (derives from arrangerObjectBase)",
      "allOf": [
        {
          "$ref": "#/definitions/arrangerObjectBase"
        },
        {
          "properties": {
            "type": {
              "const": 9
            },
            "fileAudioSource": {
              "$ref": "#/definitions/uuid",
              "description": "UUID reference in fileAudioSourceRegistry"
            }
          },
          "required": [
            "fileAudioSource"
          ]
        }
      ]
    },
    "automationRegion": {
      "$comment": "Automation region (derives from regionBase)",
      "allOf": [
        {
          "$ref": "#/definitions/regionBase"
        },
        {
          "properties": {
            "type": {
              "const": 6
            },
            "automationPoints": {
              "$ref": "#/definitions/uuidArray",
              "description": "UUID references to automationPoint objects in arrangerObjectRegistry"
            }
          }
        }
      ]
    },
    "automationPoint": {
      "$comment": "Automation point (derives from arrangerObjectBase)",
      "allOf": [
        {
          "$ref": "#/definitions/arrangerObjectBase"
        },
        {
          "properties": {
            "type": {
              "const": 7
            },
            "normalized_value": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Normalized value (0.0 to 1.0)"
            },
            "curve_options": {
              "type": "object",
              "properties": {
                "curviness": {
                  "type": "number",
                  "minimum": -1,
                  "maximum": 1,
                  "description": "Curve curviness: <0 tilts down, >0 tilts up, 0 is straight line"
                },
                "algo": {
                  "type": "integer",
                  "minimum": 0,
                  "maximum": 4,
                  "description": "Curve algorithm: 0=Exponent, 1=SuperEllipse, 2=Vital, 3=Pulse, 4=Logarithmic"
                }
              }
            }
          },
          "required": [
            "normalized_value",
            "curve_options"
          ]
        }
      ]
    },
    "chordRegion": {
      "$comment": "Chord region (derives from regionBase)",
      "allOf": [
        {
          "$ref": "#/definitions/regionBase"
        },
        {
          "properties": {
            "type": {
              "const": 5
            },
            "chordObjects": {
              "$ref": "#/definitions/uuidArray",
              "description": "UUID references to chordObject objects in arrangerObjectRegistry"
            }
          }
        }
      ]
    },
    "marker": {
      "$comment": "Marker (derives from arrangerObjectBase)",
      "allOf": [
        {
          "$ref": "#/definitions/arrangerObjectBase"
        },
        {
          "properties": {
            "type": {
              "const": 8
            },
            "markerType": {
              "type": "integer",
              "minimum": 0,
              "maximum": 2,
              "description": "0=Start, 1=End, 2=Custom"
            }
          },
          "required": [
            "markerType"
          ]
        }
      ]
    },
    "scaleObject": {
      "$comment": "Scale object (derives from arrangerObjectBase)",
      "allOf": [
        {
          "$ref": "#/definitions/arrangerObjectBase"
        },
        {
          "properties": {
            "type": {
              "const": 2
            },
            "endPosition": {
              "$ref": "#/definitions/position"
            },
            "scale": {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "description": "Musical scale type (e.g., 'Aeolian', 'Ionian')"
                },
                "rootKey": {
                  "type": "string",
                  "description": "Root note (e.g., 'C', 'A#')"
                }
              }
            }
          }
        }
      ]
    },
    "tempoObject": {
      "$comment": "Tempo object (derives from arrangerObjectBase)",
      "allOf": [
        {
          "$ref": "#/definitions/arrangerObjectBase"
        },
        {
          "properties": {
            "type": {
              "const": 10
            },
            "bpm": {
              "type": "number"
            },
            "curveAlgorithm": {
              "type": "string"
            }
          }
        }
      ]
    },
    "timeSignatureObject": {
      "$comment": "Time signature object (derives from arrangerObjectBase)",
      "allOf": [
        {
          "$ref": "#/definitions/arrangerObjectBase"
        },
        {
          "properties": {
            "type": {
              "const": 11
            },
            "numerator": {
              "type": "integer"
            },
            "denominator": {
              "type": "integer"
            }
          }
        }
      ]
    },
    "chordObject": {
      "$comment": "Chord object (derives from arrangerObjectBase)",
      "allOf": [
        {
          "$ref": "#/definitions/arrangerObjectBase"
        },
        {
          "properties": {
            "type": {
              "const": 1
            },
            "endPosition": {
              "$ref": "#/definitions/position"
            },
            "chord": {
              "type": "object",
              "properties": {
                "root": {
                  "type": "integer",
                  "minimum": 0,
                  "maximum": 11
                },
                "type": {
                  "type": "string",
                  "description": "Chord type (e.g., 'major', 'minor', '7')"
                },
                "accent": {
                  "type": "array",
                  "items": {
                    "type": "integer"
                  }
                }
              }
            }
          }
        }
      ]
    },
    "knownArrangerObjects": {
      "$comment": "Polymorphic reference for any known arranger object type",
      "oneOf": [
        {
          "$ref": "#/definitions/midiNote"
        },
        {
          "$ref": "#/definitions/midiRegion"
        },
        {
          "$ref": "#/definitions/audioRegion"
        },
        {
          "$ref": "#/definitions/audioSourceObject"
        },
        {
          "$ref": "#/definitions/automationRegion"
        },
        {
          "$ref": "#/definitions/automationPoint"
        },
        {
          "$ref": "#/definitions/chordRegion"
        },
        {
          "$ref": "#/definitions/chordObject"
        },
        {
          "$ref": "#/definitions/marker"
        },
        {
          "$ref": "#/definitions/scaleObject"
        },
        {
          "$ref": "#/definitions/tempoObject"
        },
        {
          "$ref": "#/definitions/timeSignatureObject"
        }
      ]
    },
    "folderTrack": {
      "$comment": "Folder track (derives from trackBase)",
      "allOf": [
        {
          "$ref": "#/definitions/trackBase"
        },
        {
          "properties": {
            "type": {
              "const": 6
            }
          }
        }
      ]
    },
    "knownTracks": {
      "$comment": "Polymorphic reference for any known track type",
      "oneOf": [
        {
          "$ref": "#/definitions/audioTrack"
        },
        {
          "$ref": "#/definitions/instrumentTrack"
        },
        {
          "$ref": "#/definitions/midiTrack"
        },
        {
          "$ref": "#/definitions/masterTrack"
        },
        {
          "$ref": "#/definitions/chordTrack"
        },
        {
          "$ref": "#/definitions/markerTrack"
        },
        {
          "$ref": "#/definitions/modulatorTrack"
        },
        {
          "$ref": "#/definitions/audioBusTrack"
        },
        {
          "$ref": "#/definitions/audioGroupTrack"
        },
        {
          "$ref": "#/definitions/midiBusTrack"
        },
        {
          "$ref": "#/definitions/midiGroupTrack"
        },
        {
          "$ref": "#/definitions/folderTrack"
        }
      ]
    }
  }
}
