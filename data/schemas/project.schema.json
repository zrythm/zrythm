{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "schema:project",
  "title": "Zrythm Project File",
  "description": "Schema for Zrythm project files (UNSTABLE - v2.alpha under active development)",
  "type": "object",
  "required": [
    "documentType",
    "formatMajor",
    "formatMinor",
    "appVersion",
    "datetime",
    "title",
    "projectData"
  ],
  "properties": {
    "documentType": {
      "type": "string",
      "const": "ZrythmProject",
      "description": "Document type identifier"
    },
    "formatMajor": {
      "type": "integer",
      "description": "Major format version (breaking changes)",
      "minimum": 0
    },
    "formatMinor": {
      "type": "integer",
      "description": "Minor format version (backward-compatible additions)",
      "minimum": 0
    },
    "appVersion": {
      "type": "string",
      "description": "Zrythm version that created this file"
    },
    "datetime": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 datetime when project was saved"
    },
    "title": {
      "type": "string",
      "description": "Project title"
    },
    "projectData": {
      "type": "object",
      "description": "Project data",
      "required": [
        "tempoMap",
        "transport",
        "tracklist",
        "registries"
      ],
      "properties": {
        "tempoMap": {
          "type": "object",
          "description": "Tempo and time signature map",
          "properties": {
            "timeSignatures": {
              "type": "array",
              "description": "Time signature events",
              "items": {
                "type": "object",
                "properties": {
                  "position": {
                    "type": "number",
                    "description": "Position in ticks"
                  },
                  "numerator": {
                    "type": "integer",
                    "minimum": 1
                  },
                  "denominator": {
                    "type": "integer",
                    "minimum": 1,
                    "enum": [
                      1,
                      2,
                      4,
                      8,
                      16,
                      32,
                      64,
                      128
                    ]
                  }
                }
              }
            },
            "tempoChanges": {
              "type": "array",
              "description": "Tempo change events",
              "items": {
                "type": "object",
                "properties": {
                  "position": {
                    "type": "number",
                    "description": "Position in ticks"
                  },
                  "bpm": {
                    "type": "number",
                    "minimum": 1,
                    "maximum": 1000
                  }
                }
              }
            }
          }
        },
        "transport": {
          "type": "object",
          "description": "Transport state (playhead, loop, etc.)",
          "properties": {
            "playheadPosition": {
              "$ref": "#/definitions/position"
            },
            "cuePosition": {
              "$ref": "#/definitions/position"
            },
            "loopStartPosition": {
              "$ref": "#/definitions/position"
            },
            "loopEndPosition": {
              "$ref": "#/definitions/position"
            },
            "punchInPosition": {
              "$ref": "#/definitions/position"
            },
            "punchOutPosition": {
              "$ref": "#/definitions/position"
            }
          }
        },
        "snapGridTimeline": {
          "$ref": "#/definitions/snapGrid",
          "description": "Timeline snap/grid settings"
        },
        "snapGridEditor": {
          "$ref": "#/definitions/snapGrid",
          "description": "Editor (piano roll, chord editor, etc.) snap/grid settings"
        },
        "tracklist": {
          "type": "object",
          "description": "Track list and track data",
          "required": [
            "tracks",
            "pinnedTracksCutoff",
            "trackRoutes"
          ],
          "properties": {
            "tracks": {
              "type": "array",
              "description": "UUID references to tracks in trackRegistry (ordered)",
              "items": {
                "$ref": "#/definitions/uuid"
              }
            },
            "pinnedTracksCutoff": {
              "type": "integer",
              "description": "Index separating pinned tracks from normal tracks"
            },
            "trackRoutes": {
              "type": "array",
              "description": "Routes between tracks (source-destination mappings)",
              "items": {
                "type": "array",
                "items": [
                  {
                    "$ref": "#/definitions/uuid",
                    "description": "Source track UUID"
                  },
                  {
                    "$ref": "#/definitions/uuid",
                    "description": "Destination track UUID"
                  }
                ],
                "additionalItems": false
              }
            },
            "folderParents": {
              "type": "array",
              "description": "Parent folder for each track: [childUuid, parentUuid] pairs",
              "items": {
                "type": "array",
                "items": [
                  {
                    "$ref": "#/definitions/uuid",
                    "description": "Child track UUID"
                  },
                  {
                    "$ref": "#/definitions/uuid",
                    "description": "Parent folder track UUID"
                  }
                ],
                "additionalItems": false
              }
            },
            "expandedTracks": {
              "type": "array",
              "description": "UUIDs of expanded folder tracks (absent from list = collapsed)",
              "items": {
                "$ref": "#/definitions/uuid"
              }
            }
          }
        },
        "audioPool": {
          "type": "object",
          "description": "References to audio files used in the project",
          "properties": {
            "fileHashes": {
              "type": "array",
              "description": "File hashes used for checking if an audio file is already written to the pool",
              "items": {
                "type": "array",
                "items": [
                  {
                    "$ref": "#/definitions/uuid",
                    "description": "File audio source ID from fileAudioSourceRegistry"
                  },
                  {
                    "type": "integer",
                    "description": "File hash"
                  }
                ],
                "additionalItems": false
              }
            }
          }
        },
        "portConnectionsManager": {
          "type": "object",
          "description": "Manual port connections (user routing)",
          "properties": {
            "connections": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "sourcePortId": {
                    "type": "string",
                    "description": "UUID of source port"
                  },
                  "destPortId": {
                    "type": "string",
                    "description": "UUID of destination port"
                  },
                  "multiplier": {
                    "type": "number",
                    "description": "Connection strength/gain multiplier"
                  },
                  "enabled": {
                    "type": "boolean"
                  }
                }
              }
            }
          }
        },
        "tempoObjectManager": {
          "type": "object",
          "description": "Tempo and time signature objects in arranger",
          "properties": {
            "tempoObjects": {
              "$ref": "#/definitions/uuidArray",
              "description": "UUID references to tempoObject objects in arrangerObjectRegistry"
            },
            "timeSignatureObjects": {
              "$ref": "#/definitions/uuidArray",
              "description": "UUID references to timeSignatureObject objects in arrangerObjectRegistry"
            }
          }
        },
        "clipLauncher": {
          "type": "object",
          "description": "Clip launcher with scenes and clip slots",
          "properties": {
            "scenes": {
              "type": "array",
              "description": "Scenes in the clip launcher (each scene has clip slots per track)",
              "items": {
                "$ref": "#/definitions/scene"
              }
            }
          }
        },
        "registries": {
          "type": "object",
          "description": "All UUID-indexed objects (deserialized first, then referenced)",
          "required": [
            "portRegistry",
            "paramRegistry",
            "pluginRegistry",
            "trackRegistry",
            "arrangerObjectRegistry",
            "fileAudioSourceRegistry"
          ],
          "properties": {
            "portRegistry": {
              "type": "array",
              "description": "All audio/MIDI ports",
              "items": {
                "$ref": "#/definitions/knownPort"
              }
            },
            "paramRegistry": {
              "type": "array",
              "description": "All processor parameters",
              "items": {
                "$ref": "#/definitions/parameter"
              }
            },
            "pluginRegistry": {
              "type": "array",
              "description": "All plugin instances",
              "items": {
                "$ref": "#/definitions/plugin"
              }
            },
            "trackRegistry": {
              "type": "array",
              "description": "All tracks with full data",
              "items": {
                "$ref": "#/definitions/knownTrack"
              }
            },
            "arrangerObjectRegistry": {
              "type": "array",
              "description": "All arranger objects (regions, notes, automation, markers, etc.)",
              "items": {
                "$ref": "#/definitions/knownArrangerObject"
              }
            },
            "fileAudioSourceRegistry": {
              "type": "array",
              "description": "All audio file references",
              "items": {
                "type": "object",
                "required": [
                  "id",
                  "filename",
                  "filePath"
                ],
                "properties": {
                  "id": {
                    "$ref": "#/definitions/uuid"
                  },
                  "filename": {
                    "type": "string"
                  },
                  "filePath": {
                    "type": "string",
                    "description": "Relative path in the project audio pool"
                  },
                  "sampleRate": {
                    "type": "integer"
                  },
                  "channels": {
                    "type": "integer",
                    "enum": [
                      1,
                      2
                    ]
                  },
                  "frames": {
                    "type": "integer",
                    "minimum": 0
                  },
                  "bitsPerSample": {
                    "type": "integer",
                    "minimum": 8,
                    "maximum": 32,
                    "description": "Bit depth (8, 16, 24, or 32)"
                  },
                  "format": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 4,
                    "description": "Audio format: 1=mp3, 2=flac, 3=ogg, 4=wav"
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "definitions": {
    "uuid": {
      "type": "string",
      "format": "uuid",
      "pattern": "^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",
      "description": "UUID string format"
    },
    "uuidArray": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/uuid"
      },
      "description": "Array of UUID strings"
    },
    "color": {
      "type": "string",
      "pattern": "^#[0-9A-Fa-f]{6}$",
      "description": "Hex color string in HTML #RRGGBB format (e.g., #ff5588)"
    },
    "curveOptions": {
      "type": "object",
      "description": "Curve options for interpolation between values",
      "properties": {
        "curviness": {
          "type": "number",
          "minimum": -1,
          "maximum": 1,
          "description": "Curve curviness: <0 tilts down, >0 tilts up, 0 is straight line"
        },
        "algo": {
          "type": "integer",
          "minimum": 0,
          "maximum": 4,
          "description": "Curve algorithm: 0=Exponent, 1=SuperEllipse, 2=Vital, 3=Pulse, 4=Logarithmic"
        }
      }
    },
    "position": {
      "type": "object",
      "description": "Position in time (ticks or seconds)",
      "required": ["value"],
      "properties": {
        "mode": {
          "type": "integer",
          "minimum": 0,
          "maximum": 1,
          "default": 0,
          "description": "0=musical (ticks), 1=absolute (seconds). Defaults to 0 if omitted."
        },
        "value": {
          "type": "number",
          "description": "Ticks (if mode=0 or omitted) or seconds (if mode=1)"
        }
      }
    },
    "noteLength": {
      "type": "integer",
      "minimum": 0,
      "maximum": 10,
      "description": "Bar=0, Beat=1, 2/1=2, 1/1=3, 1/2=4, 1/4=5, 1/8=6, 1/16=7, 1/32=8, 1/64=9, 1/128=10"
    },
    "noteType": {
      "type": "integer",
      "minimum": 0,
      "maximum": 2,
      "description": "0=normal, 1=dotted, 2=triplet"
    },
    "snapGrid": {
      "type": "object",
      "properties": {
        "snapEnabled": {
          "type": "boolean"
        },
        "snapNoteLength": {
          "$ref": "#/definitions/noteLength"
        },
        "snapNoteType": {
          "$ref": "#/definitions/noteType"
        },
        "adaptive": {
          "type": "boolean"
        },
        "lengthType": {
          "type": "integer",
          "minimum": 0,
          "maximum": 2,
          "description": "0=link, 1=lastObject, 2=custom"
        },
        "keepOffset": {
          "type": "boolean"
        },
        "snapToEvents": {
          "type": "boolean"
        }
      }
    },
    "registryObjectBase": {
      "$comment": "Base class for all objects in registries",
      "type": "object",
      "required": [
        "id"
      ],
      "properties": {
        "id": {
          "$ref": "#/definitions/uuid"
        }
      }
    },
    "portBase": {
      "$comment": "Base class for all port types",
      "allOf": [
        {
          "$ref": "#/definitions/registryObjectBase"
        },
        {
          "properties": {
            "type": {
              "type": "integer",
              "minimum": 0,
              "maximum": 2,
              "description": "0=audio, 1=midi, 2=cv"
            },
            "flow": {
              "type": "integer",
              "minimum": 0,
              "maximum": 1,
              "description": "0=input, 1=output"
            },
            "label": {
              "type": "string"
            },
            "symbol": {
              "type": "string"
            },
            "portGroup": {
              "type": "string"
            }
          },
          "required": [
            "type",
            "flow"
          ]
        }
      ]
    },
    "audioPort": {
      "$comment": "Audio port (derives from portBase)",
      "allOf": [
        {
          "$ref": "#/definitions/portBase"
        },
        {
          "properties": {
            "type": {
              "const": 0
            },
            "busLayout": {
              "type": "integer",
              "minimum": 0,
              "maximum": 1,
              "description": "0=mono, 1=stereo"
            },
            "purpose": {
              "type": "integer",
              "minimum": 0,
              "maximum": 1,
              "description": "0=main, 1=sidechain"
            },
            "requiresLimiting": {
              "type": "boolean"
            }
          }
        }
      ]
    },
    "midiPort": {
      "$comment": "MIDI port (derives from portBase)",
      "allOf": [
        {
          "$ref": "#/definitions/portBase"
        },
        {
          "properties": {
            "type": {
              "const": 1
            }
          }
        }
      ]
    },
    "cvPort": {
      "$comment": "CV port (derives from portBase)",
      "allOf": [
        {
          "$ref": "#/definitions/portBase"
        },
        {
          "properties": {
            "type": {
              "const": 2
            }
          }
        }
      ]
    },
    "knownPort": {
      "$comment": "Polymorphic reference for any known port type",
      "oneOf": [
        {
          "$ref": "#/definitions/audioPort"
        },
        {
          "$ref": "#/definitions/midiPort"
        },
        {
          "$ref": "#/definitions/cvPort"
        }
      ]
    },
    "parameter": {
      "$comment": "Processor parameter",
      "allOf": [
        {
          "$ref": "#/definitions/registryObjectBase"
        },
        {
          "properties": {
            "uniqueId": {
              "type": "string"
            },
            "baseValue": {
              "type": "number",
              "description": "Normalized parameter value set by the user in the UI (0.0-1.0)"
            },
            "modulationSource": {
              "$ref": "#/definitions/uuid",
              "description": "Input CV port ID for modulation, if parameter is modulatable"
            }
          },
          "required": [
            "uniqueId",
            "baseValue"
          ]
        }
      ]
    },
    "processorBase": {
      "$comment": "Base class for all processor types",
      "type": "object",
      "required": [
        "inputPorts",
        "outputPorts",
        "parameters"
      ],
      "properties": {
        "processorName": {
          "type": "string",
          "description": "Processor display name"
        },
        "inputPorts": {
          "type": "array",
          "description": "UUID references to input ports in portRegistry",
          "items": {
            "$ref": "#/definitions/uuid"
          }
        },
        "outputPorts": {
          "type": "array",
          "description": "UUID references to output ports in portRegistry",
          "items": {
            "$ref": "#/definitions/uuid"
          }
        },
        "parameters": {
          "type": "array",
          "description": "UUID references to processor parameters in paramRegistry",
          "items": {
            "$ref": "#/definitions/uuid"
          }
        }
      }
    },
    "fader": {
      "$comment": "Channel fader processor",
      "allOf": [
        {
          "$ref": "#/definitions/processorBase"
        }
      ]
    },
    "channelSend": {
      "$comment": "Channel send processor (derives from processorBase)",
      "allOf": [
        {
          "$ref": "#/definitions/processorBase"
        }
      ]
    },
    "pluginConfiguration": {
      "$comment": "Plugin configuration",
      "type": "object",
      "properties": {
        "forceGenericUi": {
          "type": "boolean"
        }
      },
      "unevaluatedProperties": false
    },
    "plugin": {
      "allOf": [
        {
          "$ref": "#/definitions/processorBase"
        },
        {
          "properties": {
            "id": {
              "$ref": "#/definitions/uuid"
            },
            "protocol": {
              "type": "integer",
              "minimum": 0,
              "maximum": 10,
              "description": "Plugin protocol: 0=internal, 1=lv2, 2=dssi, 3=ladspa, 4=vst, 5=vst3, 6=au, 7=sfz, 8=sf2, 9=clap, 10=jsfx"
            },
            "setting": {
              "$ref": "#/definitions/pluginConfiguration"
            },
            "programIndex": {
              "type": "integer"
            },
            "inlineState": {
              "$comment": "JUCE-compatible inline plugin state as a base64-encoded string",
              "type": "string"
            },
            "statePath": {
              "$comment": "Path to the plugin state, if not using inline state",
              "type": "string"
            },
            "statePathIsDirectory": {
              "$comment": "Whether the statePath is a directory (assumed to be a file if false)",
              "type": "boolean"
            },
            "visible": {
              "$comment": "Whether the plugin UI is currently opened",
              "type": "boolean"
            }
          },
          "required": [
            "id",
            "protocol",
            "setting"
          ]
        }
      ]
    },
    "pluginGroup": {
      "description": "Container for plugins and nested plugin groups (racks/chains/layers)",
      "type": "object",
      "properties": {
        "fader": {
          "$ref": "#/definitions/fader"
        },
        "deviceGroups": {
          "type": "array",
          "description": "Nested device groups (plugins or sub-groups)",
          "items": {
            "$comment": "Note: recursive refs must come first in oneOf to avoid 'already inserted' error in nlohmann::json-schema validator",
            "oneOf": [
              {
                "$ref": "#/definitions/pluginGroup",
                "$comment": "Nested container"
              },
              {
                "$ref": "#/definitions/uuid",
                "$comment": "Reference to a plugin"
              }
            ]
          }
        }
      },
      "required": [
        "fader"
      ]
    },
    "channel": {
      "type": "object",
      "description": "Track channel (fader, sends, plugins, etc.)",
      "properties": {
        "midiFx": {
          "$ref": "#/definitions/pluginGroup",
          "description": "MIDI FX plugin group (for MIDI/instrument tracks)"
        },
        "instruments": {
          "$ref": "#/definitions/pluginGroup",
          "description": "Instrument plugin group"
        },
        "inserts": {
          "$ref": "#/definitions/pluginGroup",
          "description": "Insert effects plugin group"
        },
        "preFaderSends": {
          "type": "array",
          "description": "Pre-fader channel sends",
          "items": {
            "$ref": "#/definitions/channelSend"
          }
        },
        "postFaderSends": {
          "type": "array",
          "description": "Post-fader channel sends",
          "items": {
            "$ref": "#/definitions/channelSend"
          }
        },
        "prefaderProcessor": {
          "$ref": "#/definitions/processorBase",
          "description": "Pre-fader passthrough processor"
        },
        "fader": {
          "$ref": "#/definitions/fader",
          "description": "Channel fader"
        },
        "postfaderProcessor": {
          "$ref": "#/definitions/processorBase",
          "description": "Post-fader passthrough processor"
        }
      }
    },
    "trackBase": {
      "$comment": "Base class for all track types",
      "allOf": [
        {
          "$ref": "#/definitions/registryObjectBase"
        },
        {
          "properties": {
            "type": {
              "description": "Track type discriminator (must be overridden in derived schemas)",
              "type": "integer",
              "minimum": 0,
              "maximum": 11
            },
            "name": {
              "type": "string"
            },
            "visible": {
              "type": "boolean"
            },
            "mainHeight": {
              "type": "number"
            },
            "enabled": {
              "type": "boolean"
            },
            "color": {
              "$ref": "#/definitions/color"
            },
            "comment": {
              "type": "string"
            },
            "processor": {
              "$ref": "#/definitions/processorBase"
            },
            "automationTracklist": {
              "type": "object",
              "description": "Automation tracks for this track",
              "properties": {
                "automationTracks": {
                  "type": "array",
                  "items": {
                    "$ref": "#/definitions/uuid"
                  }
                },
                "automationVisible": {
                  "type": "boolean",
                  "$comment": "Whether automation tracks should be visible"
                }
              }
            },
            "channel": {
              "$ref": "#/definitions/channel"
            },
            "lanes": {
              "type": "array",
              "description": "Track lanes",
              "items": {
                "type": "object",
                "properties": {
                  "id": {
                    "$ref": "#/definitions/uuid"
                  },
                  "name": {
                    "type": "string"
                  },
                  "height": {
                    "type": "number"
                  },
                  "mute": {
                    "type": "boolean",
                    "default": false
                  },
                  "solo": {
                    "type": "boolean",
                    "default": false
                  },
                  "midiChannel": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 16,
                    "default": 0
                  },
                  "objects": {
                    "type": "array",
                    "description": "Arranger objects contained in this lane",
                    "items": {
                      "$ref": "#/definitions/uuid"
                    }
                  }
                }
              }
            },
            "lanesVisible": {
              "type": "boolean",
              "description": "Whether track lanes should be visible"
            },
            "recordingParam": {
              "$ref": "#/definitions/uuid",
              "description": "Parameter for arming the track for recording"
            },
            "clipLauncherMode": {
              "type": "boolean",
              "description": "Whether the track is in clip launcher mode"
            },
            "pianoRoll": {
              "type": "object",
              "description": "Piano roll options if this track supports a piano roll",
              "properties": {
                "drumMode": {
                  "type": "boolean",
                  "description": "Whether drum mode in the piano roll is enabled for this track"
                },
                "midiCh": {
                  "type": "integer",
                  "minimum": 1,
                  "maximum": 16,
                  "description": "MIDI channel (1-16) to output track events in"
                },
                "passthroughMidiInput": {
                  "type": "boolean",
                  "description": "If true, input received will not be changed to the selected MIDI channel"
                },
                "midiChannels": {
                  "type": "array",
                  "description": "Flags for each MIDI channel (1-16) to enable or disable it. If not present, accepts all channels",
                  "items": {
                    "type": "boolean"
                  },
                  "minItems": 16,
                  "maxItems": 16
                }
              }
            }
          },
          "required": [
            "type",
            "name"
          ]
        }
      ]
    },
    "audioTrack": {
      "$comment": "Audio track (derives from trackBase)",
      "allOf": [
        {
          "$ref": "#/definitions/trackBase"
        },
        {
          "properties": {
            "type": {
              "const": 9
            }
          }
        }
      ]
    },
    "instrumentTrack": {
      "$comment": "Instrument track (derives from trackBase)",
      "allOf": [
        {
          "$ref": "#/definitions/trackBase"
        },
        {
          "properties": {
            "type": {
              "const": 1
            }
          }
        }
      ]
    },
    "midiTrack": {
      "$comment": "MIDI track (derives from trackBase)",
      "allOf": [
        {
          "$ref": "#/definitions/trackBase"
        },
        {
          "properties": {
            "type": {
              "const": 2
            }
          }
        }
      ]
    },
    "masterTrack": {
      "$comment": "Master track (derives from trackBase)",
      "allOf": [
        {
          "$ref": "#/definitions/trackBase"
        },
        {
          "properties": {
            "type": {
              "const": 3
            }
          }
        }
      ]
    },
    "chordTrack": {
      "$comment": "Chord track (derives from trackBase)",
      "allOf": [
        {
          "$ref": "#/definitions/trackBase"
        },
        {
          "properties": {
            "type": {
              "const": 10
            }
          }
        }
      ]
    },
    "markerTrack": {
      "$comment": "Marker track (derives from trackBase)",
      "allOf": [
        {
          "$ref": "#/definitions/trackBase"
        },
        {
          "properties": {
            "type": {
              "const": 0
            }
          }
        }
      ]
    },
    "modulatorTrack": {
      "$comment": "Modulator track (derives from trackBase)",
      "allOf": [
        {
          "$ref": "#/definitions/trackBase"
        },
        {
          "properties": {
            "type": {
              "const": 11
            },
            "modulators": {
              "$ref": "#/definitions/pluginGroup"
            },
            "modulatorMacroProcessors": {
              "type": "array",
              "description": "Modulator macro processors",
              "items": {
                "$ref": "#/definitions/processorBase"
              }
            }
          }
        }
      ]
    },
    "audioBusTrack": {
      "$comment": "Audio bus track (derives from trackBase)",
      "allOf": [
        {
          "$ref": "#/definitions/trackBase"
        },
        {
          "properties": {
            "type": {
              "const": 8
            }
          }
        }
      ]
    },
    "audioGroupTrack": {
      "$comment": "Audio group track (derives from trackBase)",
      "allOf": [
        {
          "$ref": "#/definitions/trackBase"
        },
        {
          "properties": {
            "type": {
              "const": 5
            }
          }
        }
      ]
    },
    "midiBusTrack": {
      "$comment": "MIDI bus track (derives from trackBase)",
      "allOf": [
        {
          "$ref": "#/definitions/trackBase"
        },
        {
          "properties": {
            "type": {
              "const": 7
            }
          }
        }
      ]
    },
    "midiGroupTrack": {
      "$comment": "MIDI group track (derives from trackBase)",
      "allOf": [
        {
          "$ref": "#/definitions/trackBase"
        },
        {
          "properties": {
            "type": {
              "const": 4
            }
          }
        }
      ]
    },
    "arrangerObjectBase": {
      "$comment": "Base class for all arranger objects",
      "allOf": [
        {
          "$ref": "#/definitions/registryObjectBase"
        },
        {
          "properties": {
            "type": {
              "description": "Arranger object type discriminator (must be overridden in derived schemas)",
              "type": "integer",
              "minimum": 0,
              "maximum": 11
            },
            "position": {
              "$ref": "#/definitions/position"
            },
            "length": {
              "$ref": "#/definitions/position"
            },
            "name": {
              "type": "string"
            },
            "color": {
              "$ref": "#/definitions/color"
            },
            "muted": {
              "type": "boolean"
            }
          },
          "required": [
            "type",
            "position"
          ]
        }
      ]
    },
    "regionBase": {
      "$comment": "Base class for regions (derives from arrangerObjectBase)",
      "allOf": [
        {
          "$ref": "#/definitions/arrangerObjectBase"
        },
        {
          "properties": {
            "clipStartPosition": {
              "$ref": "#/definitions/position"
            },
            "loopStartPosition": {
              "$ref": "#/definitions/position"
            },
            "loopEndPosition": {
              "$ref": "#/definitions/position"
            }
          },
          "required": [
            "clipStartPosition",
            "loopStartPosition",
            "loopEndPosition"
          ]
        }
      ]
    },
    "midiNote": {
      "$comment": "MIDI note (derives from arrangerObjectBase)",
      "allOf": [
        {
          "$ref": "#/definitions/arrangerObjectBase"
        },
        {
          "properties": {
            "type": {
              "const": 0
            },
            "pitch": {
              "type": "integer",
              "minimum": 0,
              "maximum": 127,
              "description": "MIDI note pitch (0-127)"
            },
            "velocity": {
              "type": "integer",
              "minimum": 0,
              "maximum": 127,
              "description": "MIDI note velocity (0-127)"
            }
          },
          "required": [
            "pitch",
            "velocity"
          ]
        }
      ]
    },
    "midiRegion": {
      "$comment": "MIDI region (derives from regionBase)",
      "allOf": [
        {
          "$ref": "#/definitions/regionBase"
        },
        {
          "properties": {
            "type": {
              "const": 3
            },
            "midiNotes": {
              "$ref": "#/definitions/uuidArray",
              "description": "UUID references to midiNote objects in arrangerObjectRegistry"
            }
          }
        }
      ]
    },
    "audioRegion": {
      "$comment": "Audio region (derives from regionBase)",
      "allOf": [
        {
          "$ref": "#/definitions/regionBase"
        },
        {
          "properties": {
            "type": {
              "const": 4
            },
            "audioSources": {
              "$ref": "#/definitions/uuidArray",
              "description": "UUID references to audioSourceObject objects in arrangerObjectRegistry"
            },
            "gain": {
              "type": "number",
              "minimum": 0,
              "maximum": 2,
              "default": 1.0,
              "description": "Gain multiplier (0.0-2.0)"
            },
            "musicalMode": {
              "type": "integer",
              "minimum": 0,
              "maximum": 2,
              "default": 0,
              "description": "Musical mode: 0=Inherit, 1=Off, 2=On"
            },
            "fadeInOffset": {
              "$ref": "#/definitions/position",
              "description": "Fade in duration (offset from region start)"
            },
            "fadeOutOffset": {
              "$ref": "#/definitions/position",
              "description": "Fade out duration (offset from region end)"
            },
            "fadeInOpts": {
              "$ref": "#/definitions/curveOptions",
              "description": "Fade in curve options"
            },
            "fadeOutOpts": {
              "$ref": "#/definitions/curveOptions",
              "description": "Fade out curve options"
            }
          }
        }
      ]
    },
    "audioSourceObject": {
      "$comment": "Audio source object (derives from arrangerObjectBase)",
      "allOf": [
        {
          "$ref": "#/definitions/arrangerObjectBase"
        },
        {
          "properties": {
            "type": {
              "const": 9
            },
            "fileAudioSource": {
              "$ref": "#/definitions/uuid",
              "description": "UUID reference in fileAudioSourceRegistry"
            }
          },
          "required": [
            "fileAudioSource"
          ]
        }
      ]
    },
    "automationRegion": {
      "$comment": "Automation region (derives from regionBase)",
      "allOf": [
        {
          "$ref": "#/definitions/regionBase"
        },
        {
          "properties": {
            "type": {
              "const": 6
            },
            "automationPoints": {
              "$ref": "#/definitions/uuidArray",
              "description": "UUID references to automationPoint objects in arrangerObjectRegistry"
            }
          }
        }
      ]
    },
    "automationPoint": {
      "$comment": "Automation point (derives from arrangerObjectBase)",
      "allOf": [
        {
          "$ref": "#/definitions/arrangerObjectBase"
        },
        {
          "properties": {
            "type": {
              "const": 7
            },
            "normalizedValue": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Normalized value (0.0 to 1.0)"
            },
            "curveOptions": {
              "$ref": "#/definitions/curveOptions"
            }
          },
          "required": [
            "normalizedValue",
            "curveOptions"
          ]
        }
      ]
    },
    "chordRegion": {
      "$comment": "Chord region (derives from regionBase)",
      "allOf": [
        {
          "$ref": "#/definitions/regionBase"
        },
        {
          "properties": {
            "type": {
              "const": 5
            },
            "chordObjects": {
              "$ref": "#/definitions/uuidArray",
              "description": "UUID references to chordObject objects in arrangerObjectRegistry"
            }
          }
        }
      ]
    },
    "marker": {
      "$comment": "Marker (derives from arrangerObjectBase)",
      "allOf": [
        {
          "$ref": "#/definitions/arrangerObjectBase"
        },
        {
          "properties": {
            "type": {
              "const": 8
            },
            "markerType": {
              "type": "integer",
              "minimum": 0,
              "maximum": 2,
              "description": "0=Start, 1=End, 2=Custom"
            }
          },
          "required": [
            "markerType"
          ]
        }
      ]
    },
    "scaleObject": {
      "$comment": "Scale object (derives from arrangerObjectBase)",
      "allOf": [
        {
          "$ref": "#/definitions/arrangerObjectBase"
        },
        {
          "properties": {
            "type": {
              "const": 2
            },
            "endPosition": {
              "$ref": "#/definitions/position"
            },
            "scale": {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "description": "Musical scale type (e.g., 'Aeolian', 'Ionian')"
                },
                "rootKey": {
                  "type": "string",
                  "description": "Root note (e.g., 'C', 'A#')"
                }
              }
            }
          }
        }
      ]
    },
    "tempoObject": {
      "$comment": "Tempo object (derives from arrangerObjectBase)",
      "allOf": [
        {
          "$ref": "#/definitions/arrangerObjectBase"
        },
        {
          "properties": {
            "type": {
              "const": 10
            },
            "bpm": {
              "type": "number"
            },
            "curveAlgorithm": {
              "type": "string"
            }
          }
        }
      ]
    },
    "timeSignatureObject": {
      "$comment": "Time signature object (derives from arrangerObjectBase)",
      "allOf": [
        {
          "$ref": "#/definitions/arrangerObjectBase"
        },
        {
          "properties": {
            "type": {
              "const": 11
            },
            "numerator": {
              "type": "integer"
            },
            "denominator": {
              "type": "integer"
            }
          }
        }
      ]
    },
    "chordObject": {
      "$comment": "Chord object (derives from arrangerObjectBase)",
      "allOf": [
        {
          "$ref": "#/definitions/arrangerObjectBase"
        },
        {
          "properties": {
            "type": {
              "const": 1
            },
            "endPosition": {
              "$ref": "#/definitions/position"
            },
            "chord": {
              "type": "object",
              "properties": {
                "root": {
                  "type": "integer",
                  "minimum": 0,
                  "maximum": 11
                },
                "type": {
                  "type": "string",
                  "description": "Chord type (e.g., 'major', 'minor', '7')"
                },
                "accent": {
                  "type": "array",
                  "items": {
                    "type": "integer"
                  }
                }
              }
            }
          }
        }
      ]
    },
    "knownArrangerObject": {
      "$comment": "Polymorphic reference for any known arranger object type",
      "oneOf": [
        {
          "$ref": "#/definitions/midiNote"
        },
        {
          "$ref": "#/definitions/midiRegion"
        },
        {
          "$ref": "#/definitions/audioRegion"
        },
        {
          "$ref": "#/definitions/audioSourceObject"
        },
        {
          "$ref": "#/definitions/automationRegion"
        },
        {
          "$ref": "#/definitions/automationPoint"
        },
        {
          "$ref": "#/definitions/chordRegion"
        },
        {
          "$ref": "#/definitions/chordObject"
        },
        {
          "$ref": "#/definitions/marker"
        },
        {
          "$ref": "#/definitions/scaleObject"
        },
        {
          "$ref": "#/definitions/tempoObject"
        },
        {
          "$ref": "#/definitions/timeSignatureObject"
        }
      ]
    },
    "folderTrack": {
      "$comment": "Folder track (derives from trackBase)",
      "allOf": [
        {
          "$ref": "#/definitions/trackBase"
        },
        {
          "properties": {
            "type": {
              "const": 6
            }
          }
        }
      ]
    },
    "knownTrack": {
      "$comment": "Polymorphic reference for any known track type",
      "oneOf": [
        {
          "$ref": "#/definitions/audioTrack"
        },
        {
          "$ref": "#/definitions/instrumentTrack"
        },
        {
          "$ref": "#/definitions/midiTrack"
        },
        {
          "$ref": "#/definitions/masterTrack"
        },
        {
          "$ref": "#/definitions/chordTrack"
        },
        {
          "$ref": "#/definitions/markerTrack"
        },
        {
          "$ref": "#/definitions/modulatorTrack"
        },
        {
          "$ref": "#/definitions/audioBusTrack"
        },
        {
          "$ref": "#/definitions/audioGroupTrack"
        },
        {
          "$ref": "#/definitions/midiBusTrack"
        },
        {
          "$ref": "#/definitions/midiGroupTrack"
        },
        {
          "$ref": "#/definitions/folderTrack"
        }
      ]
    },
    "clipSlot": {
      "type": "object",
      "description": "A clip slot in the clip launcher that can contain a region/clip",
      "properties": {
        "regionId": {
          "$ref": "#/definitions/uuid",
          "description": "UUID reference to a region in arrangerObjectRegistry (MidiRegion, AudioRegion, etc.)"
        }
      }
    },
    "scene": {
      "type": "object",
      "description": "A scene in the clip launcher containing clip slots for each track",
      "properties": {
        "name": {
          "type": "string",
          "description": "Scene name"
        },
        "color": {
          "$ref": "#/definitions/color",
          "description": "Scene color"
        },
        "clipSlots": {
          "type": "array",
          "description": "Clip slots for this scene, one per track (order matches tracklist order)",
          "items": {
            "$ref": "#/definitions/clipSlot"
          }
        }
      }
    }
  }
}
